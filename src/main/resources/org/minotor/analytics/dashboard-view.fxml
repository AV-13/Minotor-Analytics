<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="org.minotor.analytics.controller.DashboardController"
            styleClass="root">

    <left>
        <VBox styleClass="sidebar" prefWidth="280" minWidth="280" maxWidth="280">

            <VBox alignment="CENTER" spacing="16" styleClass="sidebar-header">
                <ImageView fx:id="logoImageView" fitWidth="80" fitHeight="80" preserveRatio="true"/>
                <Label text="MINOT'OR" styleClass="sidebar-title"/>
                <Label text="Analytics Dashboard" styleClass="sidebar-subtitle"/>
            </VBox>

            <VBox spacing="8" styleClass="sidebar-menu">
                <Button fx:id="dashboardBtn" text="ðŸ“Š Vue d'ensemble" onAction="#showDashboard" styleClass="sidebar-menu-item, sidebar-menu-active"/>
                <Button fx:id="pagesBtn" text="ðŸ“„ Pages visitÃ©es" onAction="#showPages" styleClass="sidebar-menu-item"/>
                <Button fx:id="devicesBtn" text="ðŸ’» Appareils" onAction="#showDevices" styleClass="sidebar-menu-item"/>
                <Button fx:id="eventsBtn" text="ðŸŽ¯ Types d'Ã©vÃ©nements" onAction="#showEvents" styleClass="sidebar-menu-item"/>
                <Button fx:id="reportsBtn" text="ðŸ“ˆ Rapports dÃ©taillÃ©s" onAction="#showReports" styleClass="sidebar-menu-item"/>
                <Button fx:id="settingsBtn" text="âš™ï¸ ParamÃ¨tres" onAction="#showSettings" styleClass="sidebar-menu-item"/>
            </VBox>

            <Region VBox.vgrow="ALWAYS"/>

            <VBox styleClass="sidebar-profile" alignment="CENTER" spacing="8" >
                <Label fx:id="profileNameLabel" text="Auguste Moussa" styleClass="profile-name"/>
                <Label fx:id="profileRoleLabel" text="Boulanger" styleClass="profile-role"/>

                <Button fx:id="logoutButton" text="ðŸšª DÃ©connexion"
                        onAction="#onLogoutButtonClick"
                        styleClass="sidebar-logout-btn"/>
            </VBox>
        </VBox>
    </left>

    <center>
        <ScrollPane fitToWidth="true" styleClass="main-scroll-pane">
            <VBox spacing="24" styleClass="main-content">

                <VBox fx:id="dashboardSection" spacing="24">
                    <HBox alignment="CENTER_LEFT" spacing="16" styleClass="main-header">
                        <Label text="Vue d'ensemble Analytics" styleClass="main-title"/>
                    </HBox>

                    <HBox spacing="24" alignment="CENTER" styleClass="stats-cards-container">
                        <VBox styleClass="stats-card" alignment="CENTER" spacing="8">
                            <Label text="ðŸ“Š" styleClass="stats-icon"/>
                            <Label fx:id="totalEventsLabel" text="0" styleClass="stats-value"/>
                            <Label text="Ã‰vÃ©nements totaux" styleClass="stats-label"/>
                        </VBox>

                        <VBox styleClass="stats-card" alignment="CENTER" spacing="8">
                            <Label text="ðŸ“„" styleClass="stats-icon"/>
                            <Label fx:id="uniquePagesLabel" text="0" styleClass="stats-value"/>
                            <Label text="Pages uniques" styleClass="stats-label"/>
                        </VBox>

                        <VBox styleClass="stats-card" alignment="CENTER" spacing="8">
                            <Label text="ðŸ’»" styleClass="stats-icon"/>
                            <Label fx:id="uniqueDevicesLabel" text="0" styleClass="stats-value"/>
                            <Label text="Types d'appareils" styleClass="stats-label"/>
                        </VBox>
                    </HBox>

                    <HBox spacing="16" alignment="CENTER_LEFT" styleClass="controls-bar">
                        <Label fx:id="statsLabel" text="ðŸ“… PÃ©riode :" styleClass="filter-label"/>                        <Button fx:id="filterTodayBtn" text="Aujourd'hui" onAction="#filterToday" styleClass="filter-button"/>
                        <Button fx:id="filterWeekBtn" text="Cette semaine" onAction="#filterWeek" styleClass="filter-button"/>
                        <Button fx:id="filterMonthBtn" text="Ce mois" onAction="#filterMonth" styleClass="filter-button"/>
                        <Button fx:id="filterAllBtn" text="Toutes les donnÃ©es" onAction="#filterAll" styleClass="filter-button"/>
                        <Button fx:id="refreshBtn" text="ðŸ”„ Actualiser" onAction="#refreshData" styleClass="refresh-button"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="ðŸ“¥ Exporter CSV" onAction="#exportData" styleClass="export-button"/>
                    </HBox>
                    <HBox spacing="24" alignment="CENTER">
                        <VBox styleClass="chart-card" alignment="CENTER" spacing="12">
                            <Label text="ðŸ“„ Pages les plus visitÃ©es" styleClass="chart-card-title"/>
                            <BarChart fx:id="pageViewsChart" prefWidth="400" prefHeight="300" styleClass="secondary-chart">
                                <xAxis><CategoryAxis styleClass="chart-axis"/></xAxis>
                                <yAxis><NumberAxis styleClass="chart-axis"/></yAxis>
                            </BarChart>
                        </VBox>

                        <VBox styleClass="chart-card" alignment="CENTER" spacing="12">
                            <Label text="ðŸ’» Types d'appareils" styleClass="chart-card-title"/>
                            <PieChart fx:id="deviceChart" prefWidth="350" prefHeight="300" styleClass="secondary-chart"/>
                        </VBox>
                    </HBox>
                </VBox>

                <VBox fx:id="pagesSection" spacing="24" visible="false" managed="false">
                    <HBox alignment="CENTER_LEFT" spacing="16" styleClass="main-header">
                        <Label text="Analyse des Pages" styleClass="main-title"/>
                    </HBox>

                    <VBox styleClass="chart-container">
                        <BarChart fx:id="pagesDetailChart" prefWidth="400" prefHeight="500" styleClass="main-chart">
                            <xAxis>
                                <CategoryAxis styleClass="chart-axis"
                                              tickLabelRotation="-45"
                                              tickLabelGap="5"
                                              maxWidth="380"/>
                            </xAxis>
                            <yAxis><NumberAxis styleClass="chart-axis"/></yAxis>
                        </BarChart>
                    </VBox>
                </VBox>

                <VBox fx:id="devicesSection" spacing="24" visible="false" managed="false">
                    <HBox alignment="CENTER_LEFT" spacing="16" styleClass="main-header">
                        <Label text="Analyse des Appareils" styleClass="main-title"/>
                    </HBox>

                    <HBox spacing="24" alignment="CENTER">
                        <VBox styleClass="chart-card" alignment="CENTER" spacing="12">
                            <Label text="ðŸ’» RÃ©partition dÃ©taillÃ©e" styleClass="chart-card-title"/>
                            <PieChart fx:id="devicesDetailChart" prefWidth="400" prefHeight="400" styleClass="secondary-chart"/>
                        </VBox>

                        <VBox styleClass="chart-card" alignment="CENTER" spacing="12">
                            <Label text="ðŸ“Š Statistiques appareils" styleClass="chart-card-title"/>
                            <TableView fx:id="deviceStatsTable" prefWidth="350" prefHeight="400">
                                <columns>
                                    <TableColumn fx:id="deviceNameColumn" text="Appareil" prefWidth="200"/>
                                    <TableColumn fx:id="deviceVisitsColumn" text="Visites" prefWidth="100"/>
                                    <TableColumn fx:id="devicePercentColumn" text="Pourcentage" prefWidth="50"/>
                                </columns>
                            </TableView>
                        </VBox>
                    </HBox>
                </VBox>

                <VBox fx:id="eventsSection" spacing="24" visible="false" managed="false">
                    <HBox alignment="CENTER_LEFT" spacing="16" styleClass="main-header">
                        <Label text="Types d'Ã‰vÃ©nements" styleClass="main-title"/>
                    </HBox>

                    <HBox spacing="24" alignment="CENTER">
                        <VBox styleClass="chart-card" alignment="CENTER" spacing="12">
                            <Label text="ðŸŽ¯ RÃ©partition par type" styleClass="chart-card-title"/>
                            <PieChart fx:id="eventTypesChart" prefWidth="350" prefHeight="300" styleClass="secondary-chart"/>
                        </VBox>

                        <VBox styleClass="chart-card" alignment="CENTER" spacing="12">
                            <Label text="ðŸ“ˆ Ã‰volution des Ã©vÃ©nements" styleClass="chart-card-title"/>
                            <BarChart fx:id="eventTypesBarChart" prefWidth="400" prefHeight="300" styleClass="secondary-chart">
                                <xAxis><CategoryAxis styleClass="chart-axis"/></xAxis>
                                <yAxis><NumberAxis styleClass="chart-axis"/></yAxis>
                            </BarChart>
                        </VBox>
                    </HBox>
                </VBox>

                <VBox fx:id="reportsSection" spacing="24" visible="false" managed="false">
                    <HBox alignment="CENTER_LEFT" spacing="16" styleClass="main-header">
                        <Label text="Rapports DÃ©taillÃ©s" styleClass="main-title"/>
                    </HBox>

                    <VBox spacing="16">
                        <HBox alignment="CENTER_LEFT" spacing="12" styleClass="table-header">
                            <Label text="ðŸ“Š DonnÃ©es complÃ¨tes" styleClass="section-title"/>
                            <Button fx:id="toggleTableBtn" text="â–¼ Afficher/Masquer" onAction="#toggleTable" styleClass="toggle-button"/>
                        </HBox>

                        <TableView fx:id="analyticsTable" prefHeight="400" styleClass="data-table">
                            <columns>
                                <TableColumn text="URL" fx:id="urlColumn" prefWidth="300"/>
                                <TableColumn text="Date et Heure" fx:id="dateColumn" prefWidth="160"/>
                                <TableColumn text="Appareil" fx:id="deviceColumn" prefWidth="120"/>
                                <TableColumn text="Type Ã©vÃ©nement" fx:id="typeColumn" prefWidth="150"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

</BorderPane>